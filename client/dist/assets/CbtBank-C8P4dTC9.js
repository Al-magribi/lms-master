import{b as e,aC as a,aD as s,j as l,d as n,aE as t,aF as i}from"./index-DAvLbB94.js";import{b as d,u as c}from"./vendor-CnnDPxwB.js";import{S as r}from"./react-select.esm-C351JJ6e.js";import{P as o}from"./index-CyJYIQ-o.js";import{T as m}from"./Table-BVJYUMLF.js";const u=({detail:t,setDetail:i})=>{var c;const{user:o}=e((e=>e.auth)),[m,u]=d.useState({id:"",teacher:(null==o?void 0:o.id)||null,subject:null,btype:"",name:""}),{data:b}=a(),[h,{isSuccess:p,isLoading:j,isError:x,reset:g}]=s(),N=null==b?void 0:b.map((e=>({value:e.id,label:e.name,subjects:e.subjects}))),v=null==b?void 0:b.find((e=>e.id===m.teacher)),k=(null==(c=null==v?void 0:v.subjects)?void 0:c.map((e=>({value:e.id,label:e.name}))))||[],y=e=>{const{name:a,value:s}=e.target;u((e=>({...e,[a]:s})))};return d.useEffect((()=>{(p||x)&&(u({id:"",teacher:(null==o?void 0:o.id)||null,btype:"",subject:null,name:""}),g())}),[p,x,o]),d.useEffect((()=>{t&&u({id:t.id,teacher:t.teacher||(null==o?void 0:o.id)||null,subject:t.subject,name:t.name,btype:t.btype})}),[t,o]),l.jsxs("form",{onSubmit:e=>{e.preventDefault(),n.promise(h(m).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message})},className:"bg-white p-2 rounded d-flex flex-column gap-2 border",children:[l.jsx("p",{className:"m-0 h6",children:"Bank Soal"}),l.jsx(r,{isClearable:!0,isSearchable:!0,placeholder:"Cari Guru",value:(null==N?void 0:N.find((e=>e.value===m.teacher)))||null,options:N,onChange:e=>{u((a=>({...a,teacher:(null==e?void 0:e.value)||null,subject:null})))}}),l.jsx(r,{isClearable:!0,isSearchable:!0,placeholder:"Pilih Mata Pelajaran",value:(null==k?void 0:k.find((e=>e.value===m.subject)))||null,options:k,onChange:e=>{u((a=>({...a,subject:(null==e?void 0:e.value)||null})))},isDisabled:!m.teacher}),l.jsxs("select",{name:"btype",id:"btype",className:"form-select",value:m.btype,onChange:y,children:[l.jsx("option",{value:"",hidden:!0,children:"Jenis Bank Soal"}),l.jsx("option",{value:"bank",children:"Bank"}),l.jsx("option",{value:"paket",children:"Paket"})]}),l.jsx("input",{name:"name",className:"form-control",placeholder:"Nama Bank Soal",value:m.name,onChange:y}),l.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[l.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:()=>{i({}),u({id:"",teacher:(null==o?void 0:o.id)||null,subject:null,btype:"",name:""})},children:"Batal"}),l.jsx("button",{type:"submit",className:"btn btn-sm btn-success",children:"Simpan"})]})]})},b=[{key:"no",label:"No",className:"text-center"},{key:"teacher",label:"Guru",className:"align-middle"},{key:"subject",label:"Mata Pelajaran",className:"align-middle"},{key:"bank",label:"Bank Soal",className:"align-middle"},{key:"type",label:"Jenis",className:"text-center align-middle"},{key:"questions",label:"Soal",className:"text-center align-middle"},{key:"actions",label:"Aksi",className:"text-center align-middle"}],h=({setDetail:e})=>{const a=c(),[s,r]=d.useState(1),[o,u]=d.useState(10),[h,p]=d.useState(""),{data:j={},isLoading:x}=t({page:s,limit:o,search:h}),{banks:g=[],totalData:N,totalPages:v}=j,[k,{isLoading:y}]=i();return l.jsx(m,{page:s,setPage:r,setLimit:u,setSearch:p,totalData:N,totalPages:v,isLoading:x,children:l.jsxs("table",{className:"table table-bordered table-striped table-hover m-0",children:[l.jsx("thead",{children:l.jsx("tr",{children:b.map((e=>l.jsx("th",{className:e.className,children:e.label},e.key)))})}),l.jsx("tbody",{children:(null==g?void 0:g.length)>0?null==g?void 0:g.map(((t,i)=>l.jsxs("tr",{children:[l.jsx("td",{className:"text-center align-middle",children:(s-1)*o+i+1}),l.jsx("td",{className:"align-middle",children:t.teacher_name}),l.jsx("td",{className:"align-middle",children:t.subject_name}),l.jsx("td",{className:"align-middle",children:t.name}),l.jsx("td",{className:"text-center align-middle",children:l.jsx("span",{className:"badge bg-success",children:t.btype.toUpperCase()})}),l.jsx("td",{className:"text-center align-middle",children:l.jsx("span",{className:"badge bg-secondary",children:`${t.question_count} Soal`})}),l.jsx("td",{className:"text-center align-middle",children:l.jsxs("div",{className:"dropdown",children:[l.jsx("button",{className:"btn btn-sm btn-outline-primary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",children:"Pilih Aksi"}),l.jsxs("ul",{className:"dropdown-menu",children:[l.jsx("li",{children:l.jsxs("button",{className:"dropdown-item text-primary",onClick:()=>((e,s,l)=>{const n=s.replace(/[\s/]/g,"-"),t=e.replace(/[\s/]/g,"-");a(`/admin-cbt-bank/${t}/${n}/${l}`)})(t.subject_name,t.name,t.id),children:[l.jsx("i",{className:"bi bi-folder-fill me-2"}),"Lihat"]})}),l.jsx("li",{children:l.jsxs("button",{className:"dropdown-item text-warning",onClick:()=>e(t),children:[l.jsx("i",{className:"bi bi-pencil-square me-2"}),"Edit"]})}),l.jsx("li",{children:l.jsxs("button",{className:"dropdown-item text-danger",disabled:y,onClick:()=>{return e=t.id,void(window.confirm("Apakah anda yakin ingin menghapus bank soal ini dan semua data yang terkait dengan bank soal ini?")&&n.promise(k(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},children:[l.jsx("i",{className:"bi bi-folder-minus me-2"}),"Hapus"]})})]})]})})]},t.id||i))):l.jsx("tr",{children:l.jsx("td",{colSpan:b.length,className:"text-center",children:"Data belum tersedia"})})})]})})};h.propTypes={setDetail:o.func.isRequired};const p=()=>{const[e,a]=d.useState("");return l.jsxs("div",{className:"row g-2",children:[l.jsx("div",{className:"col-lg-3 col-12",children:l.jsx(u,{detail:e,setDetail:a})}),l.jsx("div",{className:"col-lg-9 col-12",children:l.jsx(h,{setDetail:a})})]})};export{p as C};
//# sourceMappingURL=CbtBank-C8P4dTC9.js.map
