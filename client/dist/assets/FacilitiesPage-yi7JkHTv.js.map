{"version":3,"file":"FacilitiesPage-yi7JkHTv.js","sources":["../../src/page/cms/Facilities/FacilitiesPage.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport Layout from \"../layout/Layout\";\r\nimport CmsModal from \"../components/CmsModal\";\r\nimport CmsForm from \"../components/CmsForm\";\r\nimport { motion } from \"framer-motion\";\r\nimport * as FaIcons from \"react-icons/fa\";\r\nimport {\r\n  useGetFacilitiesQuery,\r\n  useAddFacilityMutation,\r\n  useDeleteFacilityMutation,\r\n} from \"../../../controller/api/cms/ApiFacility\";\r\nimport { toast } from \"react-hot-toast\";\r\nimport Table from \"../../../components/table/Table\";\r\n\r\nconst FacilitiesPage = ({ homepage }) => {\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [modalType, setModalType] = useState(\"add\");\r\n  const [selectedFacility, setSelectedFacility] = useState(null);\r\n  const [page, setPage] = useState(1);\r\n  const [limit, setLimit] = useState(10);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [formKey, setFormKey] = useState(0);\r\n\r\n  const { data, isLoading, refetch } = useGetFacilitiesQuery({\r\n    page,\r\n    limit,\r\n    search,\r\n  });\r\n  const { results: facilities, totalData, totalPage } = data || {};\r\n\r\n  const [\r\n    addFacility,\r\n    { isSuccess, error, isLoading: addLoading, data: msg, reset },\r\n  ] = useAddFacilityMutation();\r\n  const [deleteFacility] = useDeleteFacilityMutation();\r\n\r\n  const handleAdd = () => {\r\n    setModalType(\"add\");\r\n    setSelectedFacility(null);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleEdit = (facility) => {\r\n    setModalType(\"edit\");\r\n    setSelectedFacility(facility);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleDelete = async (id) => {\r\n    if (window.confirm(\"Apakah anda yakin ingin menghapus fasilitas ini?\")) {\r\n      try {\r\n        await deleteFacility(id).unwrap();\r\n        toast.success(\"Fasilitas berhasil dihapus\");\r\n        refetch();\r\n      } catch (error) {\r\n        toast.error(error.data?.message || \"Gagal menghapus fasilitas\");\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (formData) => {\r\n    try {\r\n      const formDataToSend = new FormData();\r\n      formDataToSend.append(\"name\", formData.name);\r\n\r\n      if (formData.image instanceof File) {\r\n        formDataToSend.append(\"image\", formData.image);\r\n      } else if (selectedFacility?.image) {\r\n        formDataToSend.append(\"image\", selectedFacility.image);\r\n      }\r\n\r\n      if (selectedFacility?.id) {\r\n        formDataToSend.append(\"id\", selectedFacility.id);\r\n      }\r\n\r\n      await addFacility(formDataToSend).unwrap();\r\n    } catch (error) {\r\n      console.log(error);\r\n      toast.error(error.data?.message || \"Gagal menyimpan fasilitas\");\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    setSelectedFacility(null);\r\n    setIsModalOpen(false);\r\n    setFormKey((prev) => prev + 1);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isSuccess) {\r\n      toast.success(msg.message);\r\n      setIsModalOpen(false);\r\n      refetch();\r\n      setSelectedFacility(null);\r\n      setFormKey((prev) => prev + 1);\r\n      reset();\r\n    }\r\n    if (error) {\r\n      toast.error(error.data?.message);\r\n      reset();\r\n    }\r\n  }, [isSuccess, error, msg, reset, refetch]);\r\n\r\n  const handleCloseModal = () => {\r\n    setIsModalOpen(false);\r\n    setSelectedFacility(null);\r\n    setFormKey((prev) => prev + 1);\r\n  };\r\n\r\n  const formFields = [\r\n    {\r\n      name: \"name\",\r\n      label: \"Nama Fasilitas\",\r\n      type: \"text\",\r\n      required: true,\r\n      placeholder: \"Masukkan nama fasilitas\",\r\n    },\r\n    {\r\n      name: \"image\",\r\n      label: \"Gambar\",\r\n      type: \"file\",\r\n      required: true,\r\n      placeholder: \"Pilih gambar fasilitas\",\r\n      accept: \"image/*\",\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <Layout title='Fasilitas' levels={[\"cms\"]}>\r\n      <div className='container-fluid py-3 py-md-4'>\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          transition={{ duration: 0.5 }}>\r\n          <div className='d-flex justify-content-between align-items-center mb-2'>\r\n            <div className='d-flex align-items-center'>\r\n              <div\r\n                className='p-3 rounded me-3'\r\n                style={{\r\n                  color: homepage?.primary_color,\r\n                  backgroundColor: homepage?.secondary_color,\r\n                }}>\r\n                <i className='bi bi-building fs-4'></i>\r\n              </div>\r\n              <h4 className='mb-0'>Fasilitas</h4>\r\n            </div>\r\n            <button\r\n              className='btn btn-sm btn-outline-primary'\r\n              onClick={handleAdd}>\r\n              <i className='bi bi-plus-circle'></i>\r\n              <span className='ms-2'>Tambah Fasilitas</span>\r\n            </button>\r\n          </div>\r\n\r\n          <div className='card border-0 shadow-sm'>\r\n            <div className='card-body'>\r\n              <Table\r\n                isLoading={isLoading}\r\n                page={page}\r\n                setPage={setPage}\r\n                totalPages={totalPage}\r\n                limit={limit}\r\n                setLimit={setLimit}\r\n                setSearch={setSearch}\r\n                totalData={totalData}>\r\n                <table className='mb-0 table table-bordered table-striped table-hover'>\r\n                  <thead>\r\n                    <tr>\r\n                      <th className='text-center align-middle'>No</th>\r\n                      <th className='text-center align-middle'>Gambar</th>\r\n                      <th className='text-center align-middle'>\r\n                        Nama Fasilitas\r\n                      </th>\r\n                      <th className='text-center align-middle'>Aksi</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {facilities?.map((facility, index) => (\r\n                      <tr key={facility.id}>\r\n                        <td className='text-center align-middle'>\r\n                          {(page - 1) * limit + index + 1}\r\n                        </td>\r\n                        <td className='text-center align-middle'>\r\n                          <img\r\n                            src={facility.image}\r\n                            alt={facility.name}\r\n                            width={200}\r\n                            height={100}\r\n                            style={{\r\n                              objectFit: \"cover\",\r\n                            }}\r\n                          />\r\n                        </td>\r\n                        <td className='align-middle'>{facility.name}</td>\r\n                        <td className='text-center align-middle'>\r\n                          <div className='d-flex align-items-center justify-content-center gap-2'>\r\n                            <button\r\n                              className='btn btn-sm btn-warning'\r\n                              onClick={() => handleEdit(facility)}>\r\n                              <i className='bi bi-pencil-square'></i>\r\n                            </button>\r\n                            <button\r\n                              className='btn btn-sm btn-danger'\r\n                              onClick={() => handleDelete(facility.id)}>\r\n                              <i className='bi bi-trash'></i>\r\n                            </button>\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </Table>\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n      </div>\r\n\r\n      <CmsModal\r\n        isOpen={isModalOpen}\r\n        onClose={handleCloseModal}\r\n        title={modalType === \"add\" ? \"Tambah Fasilitas\" : \"Edit Fasilitas\"}>\r\n        <CmsForm\r\n          key={formKey}\r\n          fields={formFields}\r\n          initialValues={\r\n            selectedFacility || {\r\n              name: \"\",\r\n              image: \"\",\r\n            }\r\n          }\r\n          onSubmit={handleSubmit}\r\n          onCancel={handleCancel}\r\n          submitButtonText={\r\n            modalType === \"add\" ? \"Tambah Fasilitas\" : \"Ubah Fasilitas\"\r\n          }\r\n          cancelButtonText='Batal'\r\n          isLoading={addLoading}\r\n        />\r\n      </CmsModal>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default FacilitiesPage;\r\n"],"names":["FacilitiesPage","homepage","isModalOpen","setIsModalOpen","useState","modalType","setModalType","selectedFacility","setSelectedFacility","page","setPage","limit","setLimit","search","setSearch","formKey","setFormKey","data","isLoading","refetch","useGetFacilitiesQuery","results","facilities","totalData","totalPage","addFacility","isSuccess","error","addLoading","msg","reset","useAddFacilityMutation","deleteFacility","useDeleteFacilityMutation","useEffect","c","success","message","prev","toast","_a","Layout","title","levels","children","jsx","className","jsxRuntimeExports","jsxs","motion","div","initial","opacity","y","animate","transition","duration","style","color","primary_color","backgroundColor","secondary_color","onClick","Table","totalPages","map","facility","index","src","image","alt","name","width","height","objectFit","handleEdit","async","id","window","confirm","unwrap","handleDelete","CmsModal","isOpen","onClose","CmsForm","fields","label","type","required","placeholder","accept","initialValues","onSubmit","formData","formDataToSend","FormData","append","File","console","log","onCancel","submitButtonText","cancelButtonText"],"mappings":"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"}