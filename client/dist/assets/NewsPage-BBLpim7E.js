var e=Object.defineProperty,a=(a,t,i)=>((a,t,i)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i)(a,"symbol"!=typeof t?t+"":t,i);import{j as t,i,e as s,k as l,l as n,d as r,m as d}from"./index-DAvLbB94.js";import{b as c,R as o}from"./vendor-CnnDPxwB.js";import{h as m,i as u,j as h,a as g}from"./index-B8CuzAwO.js";import{L as b}from"./Layout-Dl4dmZvm.js";import{C as p}from"./CmsModal-DgymhDA2.js";import{C as x}from"./CmsForm-CV9EwIBO.js";import{P as j}from"./index-CyJYIQ-o.js";import{Q as f,a as y,R as v}from"./quill.snow-j50-Po9E.js";import{T as N}from"./Table-BVJYUMLF.js";import"./index-Bx5UHif0.js";f.register("modules/resize",y);const w=f.import("blots/block/embed");class k extends w{static create(e){const a=super.create();return a.setAttribute("controls",""),a.setAttribute("src",e),a}static value(e){return e.getAttribute("src")}}k.blotName="audio",k.tagName="audio",k.className="ql-audio",f.register(k);class S extends c.Component{constructor(e){super(e),a(this,"handleChange",(e=>{this.setState({editorHtml:e}),this.props.onChange(e)})),a(this,"handleImageUpload",(()=>{const e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{var a;const t=e.files[0];if(t){const e=new FormData;e.append("file",t);try{const t=await fetch("/api/cms/news/upload/image",{method:"POST",body:e}),i=await t.json(),s=null==(a=this.reactQuillRef.current)?void 0:a.getEditor();if(s){const e=s.getSelection(!0);s.insertEmbed(e.index,"image",i.url)}}catch(i){console.error("Error uploading image:",i),alert("Gagal mengunggah gambar. Coba lagi.")}}}})),a(this,"handleAudioUpload",(()=>{const e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","audio/*"),e.click(),e.onchange=async()=>{var a;const t=e.files[0];if(t){const e=new FormData;e.append("file",t);try{const t=await fetch("/api/cms/news/upload/audio",{method:"POST",body:e}),i=await t.json(),s=null==(a=this.reactQuillRef.current)?void 0:a.getEditor();if(s){const e=s.getSelection(!0);s.insertEmbed(e.index,"audio",i.url)}}catch(i){console.error("Error uploading audio:",i),alert("Gagal mengunggah audio. Coba lagi.")}}}})),this.state={editorHtml:e.value||""},this.reactQuillRef=o.createRef()}componentDidUpdate(e){e.value!==this.props.value&&this.setState({editorHtml:this.props.value})}render(){const{placeholder:e,height:a,classname:i}=this.props;return t.jsx("div",{className:"d-flex mb-2",style:{height:a},children:t.jsx(v,{ref:this.reactQuillRef,theme:"snow",value:this.state.editorHtml,onChange:this.handleChange,modules:S.modules(this.handleImageUpload,this.handleAudioUpload),formats:S.formats,placeholder:e,style:{width:"100%"},className:`react-quill border border-2 bg-white rounded ${i}`})})}}S.modules=(e,a)=>({toolbar:{container:[[{header:"1"},{header:"2"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","audio","video"],["clean"]],handlers:{image:e,audio:a}},clipboard:{matchVisual:!1},resize:{modules:["Resize"]}}),S.formats=["header","font","size","bold","italic","underline","strike","blockquote","list","indent","link","image","audio","video"],S.propTypes={placeholder:j.string,value:j.string,onChange:j.func.isRequired};const C=({news:e,onBack:a})=>e?t.jsx(b,{title:e.title,levels:["cms"],children:t.jsxs("div",{className:"container py-5",children:[t.jsxs("button",{className:"btn btn-outline-secondary mb-4 d-flex align-items-center",onClick:a,children:[t.jsx(m,{className:"me-2"})," Kembali"]}),t.jsxs("article",{className:"blog-post",children:[t.jsxs("header",{className:"mb-4",children:[t.jsx("h1",{className:"display-5 fw-bold mb-3",children:e.title}),t.jsxs("div",{className:"d-flex align-items-center text-muted mb-4",children:[t.jsxs("div",{className:"d-flex align-items-center me-4",children:[t.jsx(u,{className:"me-2"}),t.jsx("span",{children:e.category_name||e.category})]}),e.createdat&&t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx(h,{className:"me-2"}),t.jsx("span",{children:new Date(e.createdat).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"})})]})]})]}),e.image&&t.jsx("div",{className:"mb-4",children:t.jsx("img",{src:e.image,alt:e.title,className:"img-fluid rounded shadow-sm",style:{maxHeight:"500px",width:"100%",objectFit:"cover"}})}),t.jsx("div",{className:"blog-content",style:{fontSize:"1.1rem",lineHeight:"1.8",color:"#333"},dangerouslySetInnerHTML:{__html:e.content}})]})]})}):null,B=({homepage:e})=>{const[a,o]=c.useState(!1),[m,u]=c.useState("add"),[h,j]=c.useState(null),[f,y]=c.useState(1),[v,w]=c.useState(10),[k,B]=c.useState(""),[D,T]=c.useState(0),[A,L]=c.useState(""),[q,E]=c.useState(!1),[R,z]=c.useState(null),{data:H}=i({page:"",limit:"",search:""}),{data:P,isLoading:U,refetch:_}=s({page:f,limit:v,search:k}),{result:F,totalData:G,totalPage:M}=P||{},[Q,{isSuccess:I,error:K,isLoading:O,data:J,reset:V}]=l(),[$]=n();c.useEffect((()=>{var e;I&&(r.success(J.message),o(!1),_(),j(null),L(""),T((e=>e+1)),V()),K&&(r.error(null==(e=K.data)?void 0:e.message),V())}),[I,K,J,V,_]);const W=()=>{E(!1),z(null)},X=[{name:"title",label:"Judul",type:"text",required:!0,placeholder:"Masukkan judul berita"},{name:"category",label:"Kategori",type:"select",required:!0,options:null==H?void 0:H.map((e=>({value:String(e.id),label:e.name})))},{name:"image",label:"Gambar",type:"file",accept:"image/*",required:!h,helpText:"Upload gambar untuk berita"}];return q&&R?t.jsx(C,{news:R,onBack:W}):t.jsxs(b,{title:"Berita",levels:["cms"],children:[t.jsx("div",{className:"container-fluid py-3 py-md-4",children:t.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:"p-3 rounded me-3",style:{color:null==e?void 0:e.primary_color,backgroundColor:null==e?void 0:e.secondary_color},children:t.jsx(g,{className:"fs-4"})}),t.jsx("h4",{className:"mb-0",children:"Berita"})]}),t.jsxs("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>{u("add"),j(null),L(""),o(!0)},children:[t.jsx("i",{className:"bi bi-plus-circle"}),t.jsx("span",{className:"ms-2",children:"Tambah Berita"})]})]}),t.jsx("div",{className:"card border-0 shadow-sm",children:t.jsx("div",{className:"card-body",children:t.jsx(N,{isLoading:U,page:f,setPage:y,totalPages:M,limit:v,setLimit:w,setSearch:B,totalData:G,children:t.jsxs("table",{className:"mb-0 table table-bordered table-striped table-hover",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center align-middle",children:"No"}),t.jsx("th",{className:"text-center align-middle",children:"Judul"}),t.jsx("th",{className:"text-center align-middle",children:"Kategori"}),t.jsx("th",{className:"text-center align-middle",children:"Tanggal Dibuat"}),t.jsx("th",{className:"text-center align-middle",children:"Aksi"})]})}),t.jsx("tbody",{children:null==F?void 0:F.map(((e,a)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center align-middle",children:(f-1)*v+a+1}),t.jsx("td",{className:"align-middle",children:e.title}),t.jsx("td",{className:"text-center align-middle",children:e.category_name}),t.jsx("td",{className:"text-center align-middle",children:new Date(e.createdat).toLocaleDateString()}),t.jsx("td",{className:"text-center align-middle",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-2",children:[t.jsx("button",{className:"btn btn-sm btn-info",title:"Lihat Detail",onClick:()=>(z(e),void E(!0)),children:t.jsx("i",{className:"bi bi-eye"})}),t.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>{return a=e,u("edit"),j({...a,category:String(a.category_id),image:a.image}),L(a.content),void o(!0);var a},children:t.jsx("i",{className:"bi bi-pencil-square"})}),t.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>(async e=>{var a;if(window.confirm("Apakah anda yakin ingin menghapus berita ini?"))try{await $(e).unwrap(),r.success("Berita berhasil dihapus"),_()}catch(t){r.error((null==(a=t.data)?void 0:a.message)||"Gagal menghapus berita")}})(e.id),children:t.jsx("i",{className:"bi bi-trash"})})]})})]},e.id)))})]})})})})]})}),t.jsx(p,{isOpen:a,onClose:()=>{o(!1),j(null),L(""),T((e=>e+1))},title:"add"===m?"Tambah Berita":"Edit Berita",size:"lg",children:t.jsx(x,{fields:X,initialValues:h||{title:"",category:"",image:""},onSubmit:async e=>{var a;const t={...e,content:A,id:null==h?void 0:h.id};if(!t.title||!t.category||!t.content||!t.image&&!h)return void r.error("Mohon lengkapi semua data");const i=new FormData;i.append("title",t.title),i.append("category",t.category),i.append("content",t.content),t.id&&i.append("id",t.id),(t.image instanceof File||"string"==typeof t.image&&t.image)&&i.append("image",t.image);try{await Q(i).unwrap()}catch(s){r.error((null==(a=s.data)?void 0:a.message)||"Gagal menyimpan berita")}},onCancel:()=>{j(null),L(""),o(!1),T((e=>e+1))},submitButtonText:"add"===m?"Tambah Berita":"Ubah Berita",cancelButtonText:"Batal",isLoading:O,children:t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"Konten"}),t.jsx(S,{value:A,onChange:L,placeholder:"Masukkan konten berita...",height:"400px"})]})},D)})]})};export{B as default};
//# sourceMappingURL=NewsPage-BBLpim7E.js.map
